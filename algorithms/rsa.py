from algorithms.utils import *
from Crypto.Util import number

def get_primes():
    p = number.getPrime(1024)
    q = number.getPrime(1024)
    return (p,q)

def key_gen():
    p, q = get_primes()
    n = p * q
    phi = (p - 1) * (q - 1)
    e = 65537
    d = multiplicative_inverse(e,phi)
    return ((e,n),(d,n))


def rsa_encrypt(public_key, message):
    message_int = int(hex_to_binary(ascii_to_hex(message)),2)
    e, mod = public_key
    ciphertext = mod_exp(message_int,e,mod)
    return ciphertext

def rsa_decrypt(private_key, ciphertext):
    d, mod = private_key
    message_int = mod_exp(ciphertext, d, mod)
    message = hex_to_ascii(binary_to_hex(int_to_binary(message_int)))
    return message

message = 'this is a message'
public_key, private_key = key_gen()
# print(public_key,private_key)
ciphertext = rsa_encrypt(private_key,message)
plaintext = rsa_decrypt(public_key,ciphertext)
# print(plaintext)

#e = 65537
#n = 28761441016147188806751957123818135775822882551927244895695663593606745625339214448654485730800583541091217232980530106039735862782719418833492000146926140139761234037247103243272743845974370342511445304614553460845086907807746234114505570032750926400744721268695551225703606325275620874406152215592383030805385598366198408300617965968980898187429312894589940741847373213257733078219395075436097051200544951375435081286130645726783293288104476072026059555206809279457344584875292495219198959115094911591439780915415645897900815288580081078023789449637074485298946802292028887382509048591056608109438418301702591361409
#d = 39248832199186836195478196032951632741427646644629159406162106563172340635924551093290282998129596844743456704066111196782851475534579375069876917483867012790628289437831414795594161666247643883793408294137631783835383104397179863310751043689962103113114780993095776863749886752440604197348670480023333139707622860412367706142942839785188617911063174686042184585567986470682556661013236931954383367927161480863163864317926219402984222173434346912495754288179021980168719349644096932135042895166351182815073674034523407867310943224534964794607580272394971140867128598252208888863258200073756771130751064016203950294401